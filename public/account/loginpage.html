<!DOCTYPE html>
<html lang="en">

<head>
    <title>로그인-Shift</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="../css/mdb.min.css" rel="stylesheet">
  <!-- Your custom styles (optional) -->
  <link href="../css/style.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../app.css">
  <link rel="stylesheet" href="../css/mdb.min_5.css">
  <script src="https://kit.fontawesome.com/22de0a02bc.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
crossorigin="anonymous"></script>
  <style>
       @media (min-width: 1500px) {
  .container {
    max-width: 1440px;
    
  }
  .form-control::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
            color: #B1B1B1;
            opacity: 1; /* Firefox */
}

.form-control:-ms-input-placeholder { /* Internet Explorer 10-11 */
            color: #B1B1B1;
}

.form-control::-ms-input-placeholder { /* Microsoft Edge */
            color: #B1B1B1;
 }
}

  </style>
  <script>
    $(document).ready(function() {  
      function toggleNavbarMethod() {  
          if ($(window).width() > 768) {  
              $('.navbar .dropdown').on('mouseover', function(){  
                  $('.dropdown-toggle', this).trigger('click');   
              }).on('mouseout', function(){  
                  $('.dropdown-toggle', this).trigger('click').blur();  
              });  
          }  
          else {  
              $('.navbar .dropdown').off('mouseover').off('mouseout');  
          }  
      }  
      toggleNavbarMethod();  
      $(window).resize(toggleNavbarMethod);  
      $("#navbar-beforelogin").load("../navbar/navbar-beforelogin.html");
      $("#navbar-afterlogin").load("../navbar/navbar-afterlogin.html");
  }); 
    
    </script>
</head>


<body>
       <!-- Navbar -->
  <!--<div id="navbar-afterlogin"></div>--> 
  <div id="navbar-beforelogin"></div>
  
  <!-- Navbar -->   

  <!--Main layout-->
  <main class="mt-4 pt-4" style="min-height: 100%; align-items: center;">
    <div class="container mt-5" style="">

      <!--Section: Post-->
      <section class="mt-0">

        <!--Grid row-->
        <div class="row justify-content-center align-middle">
            
          <!--Grid column-->
          <div class=" col-xl-6 col-lg-6 col-md-10 col-sm-12 col-xs-12 mb-4" style="max-width: 480px;">
              <div  class="text-center" style="border: solid 1px #C4C4C4; color: #333333;">
                <p class="font-weight-bold mb-5 mt-5 h4">로그인</p>
                <div style="padding: 20px 20px;">
                    <div class="form-group text-left font-weight-bold">
                        <label for="usr">이메일</label>
                        <input type="email" class="form-control" id="userEmail" placeholder="ENTER YOUR EMAIL">
                      </div>
                      <div class="form-group text-left font-weight-bold">
                        <label for="pwd">비밀번호</label>
                        <input type="password" class="form-control" id="userPassword" placeholder="ENTER YOUR PASSWORD">
                      </div>
                
                <div style="height: 30px;"></div>
                    <a type="button" class="btn btn-block text-white font-weight-bold" 
                    style="
                    background-color: #17375E;
                    border-radius: 1rem;
                    font-size: 20px;
                    " onclick="pwLogin();" >로그인</a>
                    <div class="" style="height: 20px;"></div>
                    <a type="button" class="btn btn-block font-weight-bold" 
                    style="
                    border: 2px solid #17375E;
                    color: #17375E;
                    border-radius: 1rem;
                    font-size: 20px;
                    " href="make_account.html">회원가입</a>
                </div>
                <div style="padding:20px 20px;">
                    <a class="mt-5" style="
                    color: #4E6784;
                    font-size: 15px;
                    " href="find_account_password.html">비밀번호를 잊으셨나요?</a>
                    <a type="button" class="btn btn-block font-weight-bold mt-5" 
                    style="
                    border: 2px solid #17375E;
                    color: #17375E;
                    border-radius: 1rem;
                    font-size: 20px;
                    text-transform: capitalize;" 
                    onclick="googleLogin();">Google 로그인</a>
                    <div style="height: 20px;"></div>
                    <!--<a type="button" class="btn btn-block font-weight-bold mb-5" 
                    style="
                    border: 2px solid #17375E;
                    color: #17375E;
                    border-radius: 1rem;
                    font-size: 20px;
                    text-transform: capitalize;
                    " href="">kakao 로그인</a>-->
                </div>
              </div>
            </div>
            
        </div> 

      </section>
      <!--Section: Post-->

    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small" style="
  text-align: center;
  background-color: white;
  border-top: 1px solid grey;
  ">
    <div style="height: 10px;"></div>
    <p class="mb-3" style="color: #333333;">Copyright © 2021 Shift</p>
    <p style="color: #333333;">상호: Shift | 대표: 김용운 | 개인정보관리책임자: 미입력 | 전화: 미입력 | 이메일: karlxyz99@korea.ac.kr</p>
    <div style="height: 3px;"></div>
  </footer>
  <!--/.Footer-->

  <!-- SCRIPTS -->
  <!-- JQuery -->
  <script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="../js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="../js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="../js/mdb.min.js"></script>
  <!-- Initializations -->
  <script type="text/javascript">
  
    // Animations initialization
    new WOW().init();

  </script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-database.js"></script>

<script>
var firebaseConfig = {
    apiKey: "AIzaSyCXRTprV0yWYk8YrVpopvkFM4Cv_Nmhb2g",
    authDomain: "shift-f80bc.firebaseapp.com",
    databaseURL: "https://shift-f80bc-default-rtdb.firebaseio.com",
    projectId: "shift-f80bc",
    storageBucket: "shift-f80bc.appspot.com",
    messagingSenderId: "111516463886",
    appId: "1:111516463886:web:f7ae7d49add43d4cc0dd5f",
    measurementId: "G-QXHD4RJNKQ"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
      // User is signed in.
      alert(user.displayName+"님 로그인");
      document.getElementById("loginNav").textContent = "로그아웃";
      //console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.
      var db = firebase.firestore();
      var flag = true;
      var docRef = db.collection("user").doc(user.uid);
      docRef.get().then(function(doc) {
        if (doc.exists) {
            console.log("Document data:", doc.data()); 
            window.location.href = "register_complete.html";
        } 
        else {
            db.collection("user").doc(user.uid).set({
                name: user.displayName,
                email: user.email,
                photoUrl: user.photoURL,
                emailVerified: user.emailVerified,
                account:"",
                uid: user.uid
            })
            .then(function() {
                console.log("Document successfully written!");
                alert(user.displayName+"님 회원가입 완료");
                if(user.emailVerified){
                  window.location.href = "set_account_password.html";
                }
            })
            .catch(function(error) {
                console.error("Error writing document: ", error);
            });
        }
      }).catch(function(error) {
          console.log("Error getting document:", error);
      });
    } else {
      // No user is signed in.
      alert("로그인 X");
      //console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.
    }
});


function logout() {
  alert(document.getElementById("loginNav").textContent);
  if(document.getElementById("loginNav").textContent == "로그아웃"){
    firebase.auth().signOut().then(function() {
      alert("로그아웃 성공");
    // Sign-out successful.
    }).catch(function(error) {
      alert("에러");
    // An error happened.
    });
  }
}


function pwLogin(){
  var email = document.getElementById('userEmail').value;
  var password = document.getElementById('userPassword').value;
  firebase.auth().signInWithEmailAndPassword(email, password)
  .then((user) => {
    alert("로그인 성공");
    window.location.href = "register_complete.html";
    // Signed in
    // ...
  })
  .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;
    console.log(errorCode);
    alert(errorMessage);
  });
}

function googleLogin(){
  var user = firebase.auth().currentUser;
  if (user) {
    // User is signed in.
    alert("로그인 완료");
    //console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.  
    window.location.href = "register_complete.html";
  } 
  else {
    // No user is signed in.
    alert("로그인 시작");
    var provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithRedirect(provider);
  }
}

</script>
</body>

</html>
